{
  "analyzer": "standard",
  "index": "function(doc) {\n\n    if (doc.type !== 'clinic' &&\n        doc.type !== 'district_hospital' &&\n        doc.type !== 'health_center' &&\n        doc.type !== 'person') {\n      // not a contact\n      return null;\n    }\n    var ret = new Document();\n    if (doc.name) {\n      ret.add(doc.name.toLowerCase(), { field: 'name_sorting', index: 'not_analyzed' });\n    }\n    if (doc.contact && doc.contact.name) {\n      ret.add(doc.contact.name);\n      ret.add(doc.contact.name, { field: 'contact_name' });\n    }\n\n    if (doc.type === 'person') {\n      // add parent as the clinic\n      if (doc.parent && doc.parent._id) {\n        ret.add(doc.parent._id, { field: 'clinic' });\n      }\n    } else {\n      // add self as the clinic\n      ret.add(doc._id, { field: 'clinic' });\n    }\n\n    var skip = ['_rev','id'];\n\n    Object.keys(doc).forEach(function(key) {\n      if (skip.indexOf(key) === -1 && typeof doc[key] === 'string') {\n        ret.add(doc[key]);\n        ret.add(doc[key], { field: key === '_id' ? 'uuid' : key });\n      }\n    });\n\n    return ret;\n}"
}
