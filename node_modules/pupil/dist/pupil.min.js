/*! pupil 1.0.0 2013-08-28 */
!function(){var a={},b=function(b){a[b]={name:b,toString:function(){return b}}};b("Block"),b("Func"),b("LogicalAnd"),b("LogicalOr"),b("LogicalNot"),"undefined"!=typeof module?module.exports=a:(window.pupil=window.pupil||{},window.pupil.entities=a)}(),function(){var a=function(a){this.tokens=a};a.prototype.tokenize=function(a){a=a.replace(/([^\\])\s+/g,"$1");var b,c=a.split(""),d=[],e=this.tokens,f=function(a,b){d.push({name:a,data:b||null})},g="",h=!1,i=!0,j=[],k=!1;for(b=0;b<c.length;b++){var l=c[b],m=c[b+1];if(i=!0,j=[],k=!1,h?h=!1:"\\"==l?(h=!0,k=!0,i=!1):","==l?j.push([e.Comma]):":"==l?j.push([e.Colon]):"&"==l&&"&"==m?(j.push([e.LogicalAnd]),b++):"|"==l&&"|"==m?(j.push([e.LogicalOr]),b++):"!"==l?j.push([e.LogicalNot]):"("==l?j.push([e.BracketOpen]):")"==l&&j.push([e.BracketClose]),0!==j.length||k||(g+=l,i=!1),b==c.length-1&&(i=!0),i&&""!==g&&(j.unshift([e.Identifier,g]),g=""),j.length>0)for(var n=0;n<j.length;n++)f(j[n][0],j[n][1])}return d},"undefined"!=typeof module?module.exports={create:function(b){return new a(b)}}:(window.pupil=window.pupil||{},window.pupil.lexer=a)}(),function(){var a=function(a){return{type:a,sub:[],funcName:"",funcArgs:[]}},b=function(a,b){this.message=a,this.pos=b},c=function(a,b){this.tokens=a,this.entities=b};c.prototype.parse=function(c){for(var d=this.tokens,e=this.entities,f=a(e.Block),g=[f],h=g[g.length-1],i=null,j=!0,k={identifier:!0,logicalOp:!1,negator:!0,funcArgs:!1,argSeparator:!1,block:!0},l=0;l<c.length;l++){var m=c[l],n=[],o=!1,p=!1;if(m.name==d.Identifier){if(!k.identifier)throw new b("Got an identifier, was not expecting one",l);j=!1,i?(i.funcArgs.push(m.data),k.identifier=!1,k.logicalOp=!0,k.funcArgs=!1,k.argSeparator=!0,k.block=!0,k.negator=!1):(i=a(e.Func),i.funcName=m.data,k.identifier=!1,k.logicalOp=!0,k.funcArgs=!0,k.argSeparator=!1,k.block=!1,k.negator=!1)}else if(m.name==d.Colon){if(!k.funcArgs)throw new b("Got function arguments, was not expecting them",l);j=!1,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!1,k.negator=!1}else if(m.name==d.Comma){if(!k.argSeparator)throw new b("Unexpected function argument separator",l);j=!1,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!1,k.negator=!1}else if(m.name==d.LogicalAnd){if(!k.logicalOp)throw new b("Got a logical operator (AND), was not expecting one",l);n.push(a(e.LogicalAnd)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0,k.negator=!0}else if(m.name==d.LogicalOr){if(!k.logicalOp)throw new b("Got a logical operator (OR), was not expecting one",l);n.push(a(e.LogicalOr)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0,k.negator=!0}else if(m.name==d.LogicalNot){if(!k.negator)throw new b("Got a logical operator (NOT), was not expecting one",l);n.push(a(e.LogicalNot)),j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0,k.negator=!1}else if(m.name==d.BracketOpen){if(!k.block)throw new b("Got an opening bracket, was not expecting one",l);o=!0,j=!0,k.identifier=!0,k.logicalOp=!1,k.funcArgs=!1,k.argSeparator=!1,k.block=!0,k.negator=!0}else m.name==d.BracketClose&&(p=!0,j=!0,k.identifier=!1,k.logicalOp=!0,k.funcArgs=!1,k.argSeparator=!1,k.block=!1,k.negator=!1);if(l==c.length-1&&(j=!0),j&&i&&(n.unshift(i),i=null),n.length>0)for(var q=0;q<n.length;q++)h.sub.push(n[q]);if(o){var r=a(e.Block);g.push(r),h.sub.push(r),h=g[g.length-1]}if(p){if(1===g.length)throw new b("Can't close the root block.",l);g.pop(),h=g[g.length-1]}}if(g.length>1)throw new b("All blocks weren't closed.");return f},"undefined"!=typeof module?module.exports={create:function(a,b){return new c(a,b)}}:(window.pupil=window.pupil||{},window.pupil.parser=c)}(),function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=!1,h={},i=function(){"undefined"!=typeof module?(a=require("./tokens.js"),b=require("./entities.js"),c=require("./validator_functions.js"),d=require("./lexer.js").create(a),e=require("./parser.js").create(a,b),f=require("./validator.js").create(c,b)):(a=window.pupil.tokens,b=window.pupil.entities,c=window.pupil.validator_functions,d=new window.pupil.lexer(a),e=new window.pupil.parser(a,b),f=new window.pupil.validator(c,b)),g=!0},j=function(a,b){g||i(),c[a.toLowerCase()]=b},k=function(a,b){g||i();var c={};for(var j in b){var k,l,m=a[j];m?(h[m]?l=h[m]:(k=d.tokenize(m),l=e.parse(k),h[m]=l),c[j]=f.validate(l.sub,b,j)):c[j]=!0}return c};"undefined"!=typeof module?module.exports={addFunction:j,validate:k}:(window.pupil=window.pupil||{},window.pupil.addFunction=j,window.pupil.validate=k)}(),function(){var a={},b=function(b){a[b]={name:b,toString:function(){return b}}};b("Identifier"),b("Colon"),b("Comma"),b("LogicalAnd"),b("LogicalOr"),b("LogicalNot"),b("BracketOpen"),b("BracketClose"),"undefined"!=typeof module?module.exports=a:(window.pupil=window.pupil||{},window.pupil.tokens=a)}(),function(){var a=function(a,b){this.validatorFunctions=a,this.entities=b};a.prototype.validate=function(a,b,c){for(var d=this.validatorFunctions,e=this.entities,f=!0,g=1,h=!1,i=0;i<a.length;i++){var j=a[i],k=!0,l=!1;if(j.type==e.LogicalAnd)g=1;else if(j.type==e.LogicalOr)g=2;else if(j.type==e.LogicalNot)h=!0;else if(j.type==e.Func){for(var m=j.funcName.toLowerCase(),n=[],o=0;o<j.funcArgs.length;o++)n.push(j.funcArgs[o]);if("other"==m.substr(0,5)){m=m.substr(5);var p=n.shift();n.unshift(b[p])}else n.unshift(b[c]);n.unshift(b),k=d[m].apply(this,n),l=!0}else j.type==e.Block&&(k=this.validate(j.sub,b,c),l=!0);l&&(h&&(k=!k,h=!1),f=1==g?f&&k:f||k,l=!1)}return f},"undefined"!=typeof module?module.exports={create:function(b,c){return new a(b,c)}}:(window.pupil=window.pupil||{},window.pupil.validator=a)}(),function(){var a={};a.equals=function(a,b,c){return b==c},a.iequals=function(a,b,c){return b.toLowerCase()==c.toLowerCase()},a.sequals=function(a,b,c){return b===c},a.siequals=function(a,b,c){return b.toLowerCase()===c.toLowerCase()},a.lenmin=function(a,b,c){return b.length>=c},a.lenmax=function(a,b,c){return b.length<=c},a.min=function(a,b,c){return parseInt(b,10)>=c},a.max=function(a,b,c){return parseInt(b,10)<=c},"undefined"!=typeof module?module.exports=a:(window.pupil=window.pupil||{},window.pupil.validator_functions=a)}();